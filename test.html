<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Available Currencies</title>
</head>
<body>
    <h1>Available Currencies from FixedFloat</h1>
    <button onclick="getCurrencies()">Get Currencies</button>
    <div id="currencies"></div>

    <script>
        const apiKey = 'l9zXjAOHF1Kq6TBZaNKBiD52ALX9Uhmo56qYrDBo';  // Replace with your actual API key
        const apiSecret = 'G0JdfTNxGCK4vG68eYCOyrEKiCIusKO6wcdhO6Tn';  // Replace with your actual API secret

        // Function to generate signature
        const generateSignature = (data) => {
            const encoder = new TextEncoder();
            const key = encoder.encode(apiSecret);
            const text = encoder.encode(data);
            return crypto.subtle.importKey(
                "raw", key, { name: "HMAC", hash: { name: "SHA-256" } },
                false, ["sign"]
            ).then(secretKey => {
                return crypto.subtle.sign("HMAC", secretKey, text).then(sig => {
                    const hashArray = Array.from(new Uint8Array(sig)); // convert ArrayBuffer to byte array
                    return hashArray.map(byte => byte.toString(16).padStart(2, '0')).join(''); // convert to hex string
                });
            });
        };

        const getCurrencies = async () => {
            const url = 'https://ff.io/api/v2/ccies';
            const headers = {
                'Accept': 'application/json',
                'X-API-KEY': apiKey,
                'Content-Type': 'application/json; charset=UTF-8',
            };

            const signature = await generateSignature(''); // No data, passing empty string

            // Update headers with the generated signature
            headers['X-API-SIGN'] = signature;

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: headers,
                });

                const data = await response.json();
                if (data.code === 0) {
                    displayCurrencies(data.data);
                } else {
                    console.error('Error:', data.msg);
                    document.getElementById("currencies").innerText = "Error: " + data.msg;
                }
            } catch (error) {
                console.error('Request failed', error);
                document.getElementById("currencies").innerText = "Request failed: " + error.message;
            }
        };

        const displayCurrencies = (currencies) => {
            const container = document.getElementById("currencies");
            container.innerHTML = ''; // Clear previous data
            if (currencies && currencies.length > 0) {
                const list = document.createElement('ul');
                currencies.forEach(currency => {
                    const listItem = document.createElement('li');
                    listItem.textContent = `${currency.code} - ${currency.name}`;
                    list.appendChild(listItem);
                });
                container.appendChild(list);
            } else {
                container.innerText = 'No currencies available.';
            }
        };
    </script>
</body>
</html>
